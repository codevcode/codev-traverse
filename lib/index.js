'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}var traverse=function traverse(schema){return function(middleware){return function(ctx){return function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(value){var makeNext,contents,next;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:makeNext=function makeNext(keys,schemas){var _this=this;return function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(input){var output,fallback;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:output=Array.isArray(schemas)?[]:{};fallback=null;_context2.next=4;return Promise.all(keys.map(function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(key){var sch;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:sch=schemas[key]||fallback;fallback=sch;_context.next=4;return traverse(sch)(middleware)(ctx)(input[key]);case 4:output[key]=_context.sent;case 5:case'end':return _context.stop();}}},_callee,_this)}));return function(_x3){return _ref3.apply(this,arguments)}}()));case 4:return _context2.abrupt('return',output);case 5:case'end':return _context2.stop();}}},_callee2,_this)}));return function(_x2){return _ref2.apply(this,arguments)}}()};contents=schema.contents;next=void 0;if(Array.isArray(contents)){next=makeNext(value.map(function(v,i){return i}),contents)}else if((typeof contents==='undefined'?'undefined':_typeof(contents))==='object'){next=makeNext(Object.keys(contents),contents)}else{next=function next(v){return v}}return _context3.abrupt('return',middleware(schema)(ctx)(next)(value));case 5:case'end':return _context3.stop();}}},_callee3,undefined)}));return function(_x){return _ref.apply(this,arguments)}}()}}};var compose=function compose(middlewares){return function(schema){return function(ctx){return function(next){return middlewares.map(function(m,i,a){return a[a.length-i-1]})// reverse
.reduce(function(nextHandler,mid){return mid(schema)(ctx)(nextHandler)},next)}}}};exports.default=traverse;exports.compose=compose;